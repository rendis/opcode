{
  "name": "price-monitor",
  "description": "Monitor product prices across URLs and send notifications when prices drop below thresholds.",
  "category": "commerce",
  "features": ["loop", "http", "workflow.log"],
  "input_schema": {
    "type": "object",
    "required": ["products", "notification_api_url"],
    "properties": {
      "products": {
        "type": "array",
        "description": "Array of products to monitor, each with name, url, and threshold",
        "items": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "url": { "type": "string" },
            "threshold": { "type": "number" }
          },
          "required": ["name", "url", "threshold"]
        }
      },
      "notification_api_url": {
        "type": "string",
        "description": "API endpoint to send price drop notifications"
      }
    }
  },
  "definition": {
    "timeout": "10m",
    "on_timeout": "fail",
    "steps": [
      {
        "id": "check-prices",
        "type": "loop",
        "config": {
          "mode": "for_each",
          "over": "inputs.products",
          "max_iter": 100,
          "body": [
            {
              "id": "fetch-price",
              "type": "action",
              "action": "http.get",
              "params": {
                "url": "${{loop.item.url}}"
              },
              "timeout": "15s",
              "on_error": {
                "strategy": "ignore"
              }
            },
            {
              "id": "notify",
              "type": "action",
              "action": "http.post",
              "depends_on": ["fetch-price"],
              "params": {
                "url": "${{inputs.notification_api_url}}",
                "body": {
                  "product": "${{loop.item.name}}",
                  "threshold": "${{loop.item.threshold}}",
                  "message": "Price check complete"
                }
              },
              "timeout": "15s",
              "on_error": {
                "strategy": "ignore"
              }
            }
          ]
        }
      },
      {
        "id": "log-done",
        "type": "action",
        "action": "workflow.log",
        "depends_on": ["check-prices"],
        "params": {
          "message": "Price monitoring cycle complete"
        }
      }
    ]
  }
}
