{
  "name": "onboarding-drip",
  "description": "Time-delayed onboarding email sequence with wait steps and agent engagement reasoning at the end.",
  "category": "engagement",
  "features": ["wait", "http", "reasoning", "workflow.log"],
  "input_schema": {
    "type": "object",
    "required": ["user_email", "user_name", "email_api_url"],
    "properties": {
      "user_email": {
        "type": "string",
        "description": "Email address of the newly onboarded user"
      },
      "user_name": {
        "type": "string",
        "description": "Display name of the user"
      },
      "email_api_url": {
        "type": "string",
        "description": "API endpoint for sending emails"
      }
    }
  },
  "definition": {
    "timeout": "15m",
    "on_timeout": "suspend",
    "steps": [
      {
        "id": "log-onboarded",
        "type": "action",
        "action": "workflow.log",
        "params": {
          "message": "User onboarded, starting drip sequence",
          "user_email": "${{inputs.user_email}}",
          "user_name": "${{inputs.user_name}}"
        }
      },
      {
        "id": "wait-welcome",
        "type": "wait",
        "depends_on": ["log-onboarded"],
        "config": {
          "duration": "1s"
        }
      },
      {
        "id": "send-welcome",
        "type": "action",
        "action": "http.post",
        "depends_on": ["wait-welcome"],
        "params": {
          "url": "${{inputs.email_api_url}}",
          "body": {
            "to": "${{inputs.user_email}}",
            "template": "welcome",
            "name": "${{inputs.user_name}}"
          }
        },
        "timeout": "15s",
        "retry": {
          "max": 2,
          "backoff": "linear",
          "delay": "2s"
        }
      },
      {
        "id": "wait-tips",
        "type": "wait",
        "depends_on": ["send-welcome"],
        "config": {
          "duration": "2s"
        }
      },
      {
        "id": "send-tips",
        "type": "action",
        "action": "http.post",
        "depends_on": ["wait-tips"],
        "params": {
          "url": "${{inputs.email_api_url}}",
          "body": {
            "to": "${{inputs.user_email}}",
            "template": "tips",
            "name": "${{inputs.user_name}}"
          }
        },
        "timeout": "15s",
        "retry": {
          "max": 2,
          "backoff": "linear",
          "delay": "2s"
        }
      },
      {
        "id": "wait-engagement",
        "type": "wait",
        "depends_on": ["send-tips"],
        "config": {
          "duration": "3s"
        }
      },
      {
        "id": "engagement-decision",
        "type": "reasoning",
        "depends_on": ["wait-engagement"],
        "config": {
          "prompt_context": "The onboarding drip sequence has delivered the welcome and tips emails. Evaluate whether the user appears engaged and decide on the next step.",
          "options": [
            { "id": "send-advanced", "description": "User is engaged, send advanced features email" },
            { "id": "pause-drip", "description": "User is not yet engaged, pause the drip sequence" },
            { "id": "mark-complete", "description": "User has completed onboarding, mark as done" }
          ],
          "data_inject": {
            "user_email": "inputs.user_email",
            "user_name": "inputs.user_name"
          },
          "timeout": "1h",
          "fallback": "pause-drip"
        }
      }
    ]
  }
}
